# CHAPTER 4

> 스트림에 대하여

## 스트림이란?

자바 8 API에 새로 추가된 기능이다.  데이터 컬렉션 반복을 멋지게 처리하는 기능이라고 생각하자.

멀티 스레드 코드를 구현하지 않고 데이터를 투명하게 병렬로 처리할 수 있다.

---

```java
// 저칼로리 요리명을 반환하고, 칼로리 기준으로 정렬하는 코드 

List<Dish> lowCaloricDishes = new ArrayList<>();
for(Dish dish : menu) { // 누적지로 필터링
  if(dish.getCalories() < 400){
    lowCaloricDishes.add(dish);
  }
}
Collections.sort(lowCaroricDishes, new Comparator<Dish>(){// 익명 클래스 요리 정리
  public int compare(Dish d1, Dish d2){
    return Integer.compare(d1.getCalories(),d2.getCalories());
  }
});
List<String> lowCaloricDisheName = new ArrayList<>();
for(Dish dish : lowCaloriDishes) {
  lowCalorDishesName.add(dish.getName()); // 정렬된 리스트 처리 후 요리 이름 선택
	}
}
```

여기서 lowCaloricDishes 라는 컨테이너 역할만 하는 중간 변수가 있다. 그래서 이걸 자바 8로 변경해보자



```java
List<String>lowCaloricDishesName =
  menu.stream()
  		.filter(d -> d.getCalories() < 400) // 400 칼로리 이하의 요리 선택
  		.sorted(comparing(Dish::getCalories)) // 칼로리 요리 정렬
  		.map(Dish::getName)// 요리명 추출
  		.collect(toList())l// 리스트로 변경
```

여기서 stream() 을 parallelStream( )으로 바꾸면 이 코드를 멀티코어 아키텍처에서 병렬로 실행할 수 있다.

```java
List<String> lowCaloricDishesName =
  menu.parallelStream()
  		.filter(d -> d.getCalories() < 400) // 400 칼로리 이하의 요리 선택
  		.sorted(comparing(Dish::getCalories)) // 칼로리 요리 정렬
  		.map(Dish::getName)// 요리명 추출
  		.collect(toList())l// 리스트로 변경
```

이것은 선언형 코드와 동작 파라미터화를 활용한 예다. 

필터 메서드 결과 -> sorted 메서드로 -> 맵으로 -> 컬렉션으로 연결된다.

Filter 같은 연산은 **고수준 빌딩 블록<sup>high-level building block</sup>** 으로 특정 스레딩 모델에 제한되지 않고,

자유롭게 어떤 상황에서든 사용할 수 있다. 이것이 모두 stream API 덕분이다.

Stream API 는 매우 비싼 연산이다. 

### 자바 8 스트림 API 의 특징?

- 선언형 : 더 간결하고 가독성이 좋아짐
- 조립할 수 있음 : 유연성이 좋아진다.
- 병렬화 : 성능이 좋아진다.

지금부터 주요 예제는 메뉴로 한다. 

```java
List<Dish> menu = Arrays.asList(
	new Dish("pork", false, 800, Dish.Type.MEAT),
  new Dish("beef", false, 700, Dish.Type.MEAT),
  new Dish("chicken", false, 800, Dish.Type.OTHER),
  new Dish("pizza", true, 120, Dish.Type.MEAT),
  new Dish("pork", false, 800, Dish.Type.MEAT),
  new Dish("pork", false, 800, Dish.Type.MEAT),
  new Dish("pork", false, 800, Dish.Type.MEAT)
)
```

