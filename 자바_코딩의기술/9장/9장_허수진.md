## 09 실전 준비

> 코드의 첫 90에 개발시간 10가 쓰임. 코드의 나머지 10에 개발시간 90이 쓰임



### 9-1 정적 코드 분석 도구

 코드 품질을 가늠하는 일종의 높이 뛰기의 바 같은 것이다.



살재 개발과 생산과정에 한층 더 가깝다. 코드를 고장내지는 않더라도 품질을 떨어트리는 실수를 

잘 잡아내곤 한다.

컴파일 오류와 기능적 오류를 넘어서는 특정 유형의 문제를 코드에ㅔ서 자동으로 감지할 수 있으며 심지어 수정을 도와주는 도구도 있다. 

### Error Prone 

구글에서 자체 오류를 찾아내기 위해 만들어짐

### 인텔리제어 Code Inspection 

수정본을 제안하며, 클릭 한번으로 리팩터링할 수있음.

정적분석도구는 컴파일러나 테스트로 찾지 못하는 코드 내 문제를 발견하는데 매우 유용하고 효율적임.



### 9-2 팀 내 자바 포맷 통일

전문 sw 개발은 팀으로 이루어 짐.

Scrum 이나 xp 같은 애자일 프로세스가 방법을 알려줌. 코드에 영향을 미치는 팀 요구사항인 서식화 때문

제일 좋은 방법은 `구글 자바 스타일 가이드`를 사용하는 것.



### 9-3 빌드 자동화

gradle 과 같은 도구로 빌드를 자동화하자. 안드로이드의 기본 빌드 시스템이다.

빌드를 자동화 하려면 빌드 파일을 작성해 프로젝트에 넣어야한다. '



### 9-4 지속적 통합

로컬에서 코드를 변경 하려면 당연히 커밋하기 전에 단위 테스트를 실행해 고장난 부분이 없는지 확인해야 합니다.

도구들은 공통적으로 코드 기반에 대해 실행되고 코드 기반 내에 잠재적 이슈를 보여줌. 어떤 이슈느느 바로 고칠 수 있고

긍정 오류는 그냥 무시할 수 있음.

`젠킨슨 Jenkins` 을  설치하고 사용하면 전용품질 ㅅ분석 서버를 사용할 수 있음. 

아니면 소나 큐브로 직접 호스팅하거나 Travis-ci 나 codacy 처럼 테스트와 품질 분석에 사용할 만한 클라우드 서비스도 많음. 

빌드와 테스트가 끝났으면 납품도 해야겠지?



### 9-5 생산 준비와 납품

고객은 지금까지 테스트 되지 않았던 수많은 방법으로 소프트웨어를 사용하므로 요청 지연과 오류, 예상하지 못한 동작이 쇄도한다. 

이런 문제를 해결하기 위해서는 문제 원인과 이걸 찾기 위한 통찰력이 필요하다.

`로그, 수치, 대시보드, 알람` 형태로 감시를 구현해야한다. 우선 콘솔 출력 대신 로깅을 해야한다. 이어서 모든 로그가 모일 중앙 위치를 설정한다.

그러면 수치를 계산해 대시보드에 시각화도 할수 있다. 

이건 `open source Elastic Stack 과 그레이로그` 가 이런 작업에 걸맞는다.



생산에서 발견된 오류와 예외에는 특히 더 주목해야한다. 코드의 버그와 테스트의 허점을 드러내는 네온사인으로서 스택 추적과 맥락 정보가 그야말로 제역할을 한다.  자동으로 발생했던 모든 예외를 모으고 추적을 도와주는 것은 `에어브레이크`가 있다.



### 9-6 콘솔 출력 대신 로깅

```java
class LaunchChecklist {
  
  private static final Logger LOGGER = LogManger.getLogger(LaunchChecklist.class)
    
}
```

print 로 하는것이 아닌, Log4j 를 사용하면 - 명령문이 언제 출력되는지 , 출력하는 코드 행 수, 메서드 매개변수 값, 출력된 명령문의 중요도 등등을 알 수 있다. 



### 9-7 다중 스레드 코드 최소화 및 독립 

생산에서 프로그램은 반드시 실행할 수 있어야 함.

가장 필요한 것은 오늘 날 장비의 다중 코어 기능을 활용하는 `동시 실행(concurrency)` 이다. 

1. 우선 최대한 다중 스레드 코딩은 하지말자
2. 코드를 측저앟 ㄴ후 너무 느릴 때만 다중 스레드를 활용하자

최대한 가변상태보다 불변 상태로 만들어야한다. 가변 데이터는 경합 조건이나 갱신 무효와 같은 동시 실행 버그를 일으키기 쉽다. 

추천 책은 자바 동시 실행 전에 나오는 JCIP표기 



### 9-8 고급 동시 실행 추상화 사용하기 

대부분 프로그램을 다중 스레드로 만들어야한다.

웹 어플리케이션은 동시에 여러 사용자를 처리해야하기에

화면간 상호작용은 UI 스레드로, 계산 집약적 작업읍 백그라운드 스레드로

전형적으로 메모리를 통해 스레드 간 커뮤니케이션을 수행한다. 

자바는 volatile synchronized 와 같은 키워드로 동기화 영역을 지원하고 있다.

이러한 클래스를 올바르게 사용하려면 자바 메모리 모델과 모델 내 상태변경간 전후 관계가 어떻게 동작하는지 완벽히 이해해야한다. 

책 추천 <자바 동시 실행 실전> <JVM에서 동시 실행 프로그래밍>



### 9-9 프로그램 속도 향상

```java
class Inventory {
  List<s> s;
  
  long countDifferentKinds(){
    return s.stream()
      .parallel() // 병렬로 실행하라고 알림 일부만 병렬화는 불가능함
      .filter()
      --- 등등등
  }
}
```



### 9-10 틀린 가정 알기

  형식에 대해서 알지 못하면 최소한으로 가정하는 것이 최선이다. 

이름은 너무 복잡하다. 이름에 Null 이 포함된 사람도 있을 것이다. 